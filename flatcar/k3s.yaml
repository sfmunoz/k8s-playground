variant: flatcar
version: 1.0.0

systemd:
  units:
    - name: k3s-install.service
      enabled: true
      contents: |
        [Unit]
        Description=K3s install
        Wants=network-online.target
        After=network-online.target
        ConditionFirstBoot=yes
        [Service]
        Type=oneshot
        Restart=on-failure
        RemainAfterExit=true
        ExecStart=/usr/bin/bash -c 'set -e -o pipefail ; curl -sfL https://get.k3s.io | sh -'
        [Install]
        WantedBy=multi-user.target

storage:
  files:
    - path: /etc/flatcar/update.conf
      overwrite: true
      contents:
        inline: |
          REBOOT_STRATEGY=reboot
          REBOOT_WINDOW_START=01:30
          REBOOT_WINDOW_LENGTH=1h
      mode: 0420

passwd:
  users:
  - name: core
    ssh_authorized_keys:
    - "ssh-rsa AAAA..."
