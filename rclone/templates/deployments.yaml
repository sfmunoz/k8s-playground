apiVersion: apps/v1
kind: Deployment
metadata:
  name: rclone-deploy
  labels:
    app: rclone
spec:
  replicas: 1
  selector:
    matchLabels:
      app: rclone
  template:
    metadata:
      labels:
        app: rclone
    spec:
      containers:
{{ include "rclone.container" ( dict "root" . "cmd" "/scripts/rclone.sh" "volName" "vol-c" ) | indent 6 }}
        - name: vol-loc
          mountPath: /loc
        - name: vol-scripts
          mountPath: /scripts
          readOnly: true
      volumes:
{{ include "rclone.volume" ( dict "root" . "volName" "vol-c" "secName" "rclone-conf" "secKey" "rcloneConf" ) | indent 6 }}
      - name: vol-loc
        emptyDir: {}
      - name: vol-scripts
        configMap:
          name: "rclone-script"
          items:
          - key: rclone-ls
            path: rclone.sh
            mode: 0777
