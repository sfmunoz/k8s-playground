+----------+
| Postgres |
+----------+

Install/upgrade (usual: release-name="pdb"):

  $ helm upgrade --install -n dev --create-namespace -f secrets://secrets.yaml <release-name> .

Install/upgrade (empty database):

  $ helm upgrade --install -n dev --create-namespace -f secrets://secrets.yaml --set postgres.empty=true <release-name> .

{{ include "postgres.fullname" . }}

Test (once deployed using release-name="{{ .Release.Name }}"):

  $ helm test -n {{ .Release.Namespace }} --logs {{ .Release.Name }}
  $ helm test -n {{ .Release.Namespace }} --logs --filter name={{ include "postgres.test.backup" . }} {{ .Release.Name }}
  $ helm test -n {{ .Release.Namespace }} --logs --filter name=pdb-postgres-pgbench-test {{ .Release.Name }}

Uninstall/cleanup:

  $ helm uninstall -n {{ .Release.Namespace }} {{ .Release.Name }}
  $ kubectl delete namespaces {{ .Release.Namespace }}

Template:

  $ helm install --dry-run --debug --disable-openapi-validation -f secrets://secrets.yaml -n {{ .Release.Namespace }} {{ .Release.Name }} .
  $ helm template .
